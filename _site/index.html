<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  	<title>AutoBox - On the fly Dependency Injection and caching container</title>
  	<link rel="stylesheet" href="style.css" type="text/css" />
	<link rel="stylesheet" title="github" href="highlight/styles/github.css">
</head>
 
<script src="highlight/highlight.pack.js"></script>
 
<body>
   
  <a href="https://github.com/mehfuzh/AutoBox"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://assets1.github.com/img/7afbc8b248c68eb468279e8c17986ad46549fb71?repo=&url=http%3A%2F%2Fs3.amazonaws.com%2Fgithub%2Fribbons%2Fforkme_right_darkblue_121621.png&path=" alt="Fork me on GitHub"></a>
  
   <section class="mustHead">
        <title>AutoBox - On the fly Dependency Injection and caching container</title> 
	    <img src="images/autoboxLogo-medium.jpg" alt="autobox">
    </section>
    
    <section class="headerText">
		AutoBox is a on the fly dependency injection and caching container. It dynamically injects dependencies based on convention. Also, let you cache repository calls to memcached (the most popular cross-platform caching system).









	</section>

	
	<section class="content">


	<div Id="nuget-install">
		<span>PM > Install-Package AutoBox</span>
	</div>
	
	

		<h3>Gettting Started</h3>

	<p>Lets take that you have a controller and the constructor looks like this :</p>

<pre><code>public AccountController(IAccountService service)
{
	this.service = service;
}</code></pre>

<p><em>AccountService</em> is implemented in MyCoolWebSite.Services folder, in global.ascx you first need to add the following line:</p>

<pre><code>Container.Init();</code></pre>

<p>However it is possible to specify assembly explictly. For example:</p>

<pre><code>Container.Init(Resolve.FromCurrentAssembly);</code></pre>

<p>Similarly, you can do:</p>

<pre><code>Container.Init(Resolve.From(&lt;YOUR_ASSEMBLY&gt;));</code></pre>

<p>Here to mention that AutoBox is a convention based tool, it means IAccountService will search for AccountService class that implements it.</p>

<p>Next you need to override the <strong>GetControllerInstance</strong> from DefaultControllerFactory. Since AutoBox is implemented using <strong>CommonServiceLocator</strong> you can directly include <em>ServiceLocator.Current.GetInstance</em> that will return the target controller with depencies properly injected.</p>

<pre><code>protected override IController GetControllerInstance(System.Web.Routing.RequestContext requestContext, Type controllerType)
{
        return ServiceLocator.Current.GetInstance(controllerType) as IController;
}</code></pre>

<p>And at the end of the Global.ascx.cs you need to write this line, so that the request goes through <em>AutoBox</em>:</p>

<pre><code>ControllerBuilder.Current.SetControllerFactory(new MyControllerFactory());</code></pre>

<p>Now, moving forward there is a method in IProuductRepository lets say IProductReposiroty.GetAllProducts();</p>

<p>You just dont want to hit database all the time, unless invalidated. Therefore, you can further specify:</p>

<pre><code>Container.Setup&lt;ProductRepository&gt;(x=&gt; x.GetAllProducts()).Caches(TimeSpan.FromMinutes(10));</code></pre>

<p>This tells AutoBox to cache the result of the call that will automatically invalidate after 10 minutes. However you can explictly specify the method that will invalidate it.</p>

<pre><code>Container.Setup&lt;ProductRepository&gt;(x=&gt; x.Create(Arg.Varies&lt;Product&gt;()).Invalidates(x =&gt; x.GetAllProducts());</code></pre>

<p><em>Arg.Varies</em> speicifies <em>Any</em> arguments. It can be also used for caching , this will act similar to <em>VaryByParams</em>.</p>

<p>However to cache an repository call, instead of Arg.Varies if you just want to pass default values and want to specify varible argument setup fluently, you can always do:</p>

<pre><code>Container.Setup&lt;ProductRepository&gt;(x=&gt; x.GetPrdocutById(0)).Caches(TimeSpan.FromMinutes(10)).VaryByArgs();</code></pre>

<p>Finally to make <em>Memcached</em> working you will need to have the following block in web.config (will be added automatically when installed from NUGet).</p>

<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;configuration&gt;

	&lt;configSections&gt;
			&lt;section name=&quot;autoBox&quot; type=&quot;AutoBox.AutoBoxSection, AutoBox&quot; /&gt;
	&lt;/configSections&gt;

	&lt;autoBox cacheStore=&quot;localhost&quot; cacheProvider=&quot;MemcachedProvider&quot; /&gt;

&lt;/configuration&gt;</code></pre>

<p>Here you will notice that by default its pointing to <em>localhost</em> and <em>MemcachedProvider</em>. However it can be an external IP pointing to <strong>Amazon ElastiCache</strong>(released a few weeks ago).Here to note that memcached is a caching machanism and therefore the tool is agnostic of underlying cloud service that you may use.</p>

<p>To test caching locally, you can use the <em>CouchBase Membase server</em> (Not limited to), it gives you a nice web based GUI to monitor the cache usage, configure memory and clusters.</p>

<p>You can download it from this link:</p>

<p><a href='http://www.couchbase.com/products-and-services/memcached/'>http://www.couchbase.com/products-and-services/memcached/</a></p>

<p>Once installed, you can double-click the &#8220;Membase Console&#8221; from desktop which will take you through an easy wizard to configure memcached.</p>

<p>Moving forward, there is a <strong>AutoBox.Specification</strong> project. You can use <em>TestDriven.Net</em> to verify that all the tests pass and you have configured things correctly.</p>

<p>This is an early preview, therefore there might be glitches and feel free to file them and raise questions.</p>


	

		<h3>What is memcached ?</h3>

	<p>Free &amp; open source, high-performance, distributed memory object caching system, generic in nature, but intended for use in speeding up dynamic web applications by alleviating database load.</p>

<p>Memcached is an in-memory key-value store for small chunks of arbitrary data (strings, objects) from results of database calls, API calls, or page rendering.</p>

<p>you will find more information on this at : <a href='http://www.memcached.org/'>http://www.memcached.org/</a></p>


	

		<h3>Resources</h3>

	<p>If dont want to use membase server (which is pretty easy) then you can also try the command-line tool from <a href='http://code.jellycan.com/memcached/'>jellycan</a>.</p>

<p>There is a nice document on getting started with Amazon ElastiCache:</p>

<p><a href='http://docs.amazonwebservices.com/AmazonElastiCache/latest/GettingStartedGuide/'>Getting started with Amazon ElastiCache</a></p>


	

		<h3>Known issues</h3>

	<p><strong>VerificationException -&gt; Operation could destablize the runtime</strong></p>

<p>This happens due to the conflict between NewtonSoft.dll and Intellitrace.Try to add NewtonSoft.dll to intellitrace ignore list.</p>

<ul>
<li>Tools -&gt; Options -&gt; Intellitrace -&gt; Modules</li>

<li>Add -&gt; NewtonSoft</li>
</ul>

<p>However, you can also turn off the intellitrace to avoid this.</p>


	

		<h3>Troubleshoot</h3>

	<p><em>Configuring Membase server</em></p>

<p>Since membase uses <em>IP_Addr.bat</em> from %Program_Files%\Membase\Server\bin that dynamically resolves the IP for your machine. In case that you are under a router and your IP is assigned dynamically each time, you can try the following:</p>

<p>Update the follwoing line in <em>service_register.bat</em>:</p>

<pre><code>Set IP_ADDR=127.0.0.1</code></pre>

<p>Once you are done, you can run <em>service_register.bat</em>(from command line or just double click it) that will initalize and register the membase server as a local service with your specified IP.</p>

<p>Moreover, you might find that membase server is not starting if you dont have VC++ redist installed. In that regard please check the following thread:</p>

<p>http://couchbase.org/forums/thread/membase-17-error-startup</p>


	

		<h3>Revision History</h3>

	<p>v1.0.1 : Initial release</p>

<p>v1.0.2 : Exception for null controller type (Skip resolve)</p>

<p>v1.0.3 : Included fluent <em>VaryByArgs</em> for <em>Caches</em> method</p>


	

	<p class="smallText">Copyright 2011, Licensed under MIT opensource</p>
	
	</section>

</body>

<script type="text/javascript">
hljs.tabReplace = '    '; // 4 spaces
hljs.initHighlightingOnLoad();
</script>

</html>
